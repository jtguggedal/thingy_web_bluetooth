<!doctype html>
<html>
  <head>
    <title>Thingy:52 Web Bluetooth</title>
  </head>
  <body>
    <button id="connectBtn">Connect</button>
    <div id="temperature"></div>
    <script type="module">
      
      import {Thingy} from "./js/thingy.js";
      
      const thingy = new Thingy({logEnabled: true});

      async function start(device) {
        await device.connect();
        await device.ledBreathe({color: "red", intensity: 10, delay: 1500});
        await device.buttonEnable(onButtonChange, true);
      }

      function onTemperatureUpdate(data) {
        const el = document.querySelector("#temperature");
        el.innerHTML = `Temperature: ${data.value.toFixed(1)} ${data.unit}`;
      }

      document.querySelector("#connectBtn").addEventListener("click", async () => {
          await start(thingy);
      })

      function onButtonChange(state) {
            console.log('Button: ' + state);

            let button = state;

            if (state == 1)
            {
                var led = {
                    red: 1,
                    green: 40,
                    blue: 1
                };
                /*
                connected_thingy.mic_enable(function(error) {
                    console.log('Microphone enabled! ' + ((error) ? error : ''));
                });*/

                setTimeout(function() {
                    if (button === 1) {
                        thingy.ledConstant(led);
                    }
                }, 1);
            }
            else
            {
                var led = {
                    color: 6,
                    intensity: 20,
                    delay: 3500
                };
                /*
                thingy.mic_disable(function(error) {
                    console.log('Microphone disabled! ' + ((error) ? error : ''));
                });*/

                thingy.ledBreathe({color: 'red', intensity: 10, delay: 1500});
            }
        }

    </script>
  </body>
</html>

